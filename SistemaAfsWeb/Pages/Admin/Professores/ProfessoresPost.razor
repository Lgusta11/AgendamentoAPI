@page "/admin/professores/cadastrar"
@inject HttpClient _httpClient
@inject IJSRuntime JS
@inject CadastroAPI professoresAPI
@inject NavigationManager NavManager


<center>
<MudContainer>
    <MudItem xs="12" sm="7">
        <MudCard>
            <MudForm Model="@professor" ValidationDelay="0">
                <MudCardContent>
                    <MudTextField @bind-Value="professor.nome" For="@(() => professor.nome)" Immediate="true" Label="Nome" FullWidth Required="true" />
                    <MudTextField @bind-Value="professor.email" For="@(() => professor.email)" Immediate="true" Label="Email" FullWidth Required="true" />
                    <MudTextField @bind-Value="professor.senha" For="@(() => professor.senha)" Immediate="true" Label="Senha" FullWidth InputType="InputType.Password" Required="true" />
                    <MudTextField @bind-Value="professor.confirmacaoSenha" For="@(() => professor.confirmacaoSenha)" Immediate="true" Label="Confirmação de Senha" FullWidth InputType="InputType.Password" Required="true" />
                </MudCardContent>
                <MudCardActions>
                    <div class="d-flex align-center justify-space-between mt-4">
                        <MudButton Variant="@MudBlazor.Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="@(async () => await CadastrarProfessor())">Cadastrar</MudButton>
                    </div>
                </MudCardActions>
            </MudForm>
        </MudCard>
    </MudItem>
</MudContainer>
</center>


@code {
    ProfessoresRequest professor = new ProfessoresRequest();
    string apiError = string.Empty;

    [Inject] ISnackbar? Snackbar { get; set; }

    private async Task CadastrarProfessor()
    {
        if (string.IsNullOrWhiteSpace(professor.nome))
        {
            apiError = "O campo Nome é obrigatório.";
            Snackbar.Add(apiError, Severity.Warning);
            return;
        }

        if (string.IsNullOrWhiteSpace(professor.email) || !professor.email.Contains("@"))
        {
            apiError = "Por favor, insira um endereço de e-mail válido.";
            Snackbar.Add(apiError, Severity.Warning);
            return;
        }

        if (string.IsNullOrWhiteSpace(professor.senha) || professor.senha.Length < 6)
        {
            apiError = "A senha deve ter pelo menos 6 caracteres.";
            Snackbar.Add(apiError, Severity.Warning);
            return;
        }

        if (professor.senha != professor.confirmacaoSenha)
        {
            apiError = "A senha e a confirmação de senha não correspondem.";
            Snackbar.Add(apiError, Severity.Warning);
            return;
        }

        // Enviar a solicitação para a API
        var response = await professoresAPI.CadastroProfessorAsync(professor);
        if (response != null)
        {
            NavManager.NavigateTo("/admin/professores");
            Snackbar.Add("Professor cadastrado com sucesso!", Severity.Success);
        }
        else
        {
            apiError = "Erro ao cadastrar professor.";
            Snackbar.Add(apiError, Severity.Error);
        }
    }
}



